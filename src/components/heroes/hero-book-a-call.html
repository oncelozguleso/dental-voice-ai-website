<!-- UnicornStudio Background (Lazy Loaded) -->
<div class="aura-background-component top-0 w-full h-[900px] sm:h-[850px] lg:h-[900px] -z-10 absolute" data-unicorn-studio="x6cbPWi9roeeiZ8cuBu3"></div>

        <!-- Hero -->
        <section id="book-a-call-section" class="relative mb-8">
    
          <div class="max-w-7xl lg:px-8 mr-auto ml-auto px-1 sm:px-4 md:px-6">
            <div class="mx-auto max-w-4xl text-center pt-10 sm:pt-14 px-4 sm:px-0">
              <!-- Form Container -->
              <div class="relative z-10 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl mx-auto max-w-5xl overflow-hidden" style="background: rgba(64, 64, 64, 0.85);">
                <div class="p-8 pb-4">
                  <!-- Countdown Timer -->
                  <div class="text-center mb-4">
                    <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-red-500/20 border border-red-400/30 text-red-200 text-sm animate-pulse">
                      <span class="h-2 w-2 rounded-full bg-red-400 animate-ping"></span>
                      <span class="font-medium">Limited Time:</span>
                      <span id="book-a-call-countdown-timer" class="font-mono font-bold">--:--:--</span>
                      <span class="text-xs">left</span>
                    </div>
                  </div>
                  
                  <h2 class="text-2xl sm:text-3xl font-semibold text-white mb-2">Start Your <span data-geo-trial-price>A$1</span> Trial - 10 Days</h2>
                  <p class="text-white/70 text-sm sm:text-base">Fill out the form below to get started with your Voice AI trial</p>
      </div>
    
                <!-- Custom Booking Form -->
                <div class="overflow-hidden">
                  <form id="customBookingForm" class="space-y-4 p-6">
                    
                    <!-- Progress Bar -->
                    <div class="mb-6">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-neutral-300">Step <span id="currentStepNumber">1</span> of 3</span>
                        <span class="text-xs text-neutral-400"><span id="progressPercentage">33</span>% Complete</span>
                      </div>
                      <div class="w-full bg-neutral-700/50 rounded-full h-2">
                        <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-purple-500 h-2 rounded-full transition-all duration-300" style="width: 33%"></div>
                      </div>
                      <div class="flex justify-between mt-2 text-xs text-neutral-400">
                        <span id="step1Label" class="text-indigo-400 font-medium">Personal Info</span>
                        <span id="step2Label">Contact Details</span>
                        <span id="step3Label">Practice Info</span>
                      </div>
                    </div>

                    <!-- Form Content Container with Fixed Height -->
                    <div class="min-h-[280px] flex flex-col">
                      
                      <!-- Step 1: Personal Information -->
                      <div id="step1" class="form-step flex-1">
                        <div class="mb-4">
                          <h3 class="text-lg font-semibold text-white mb-2">Personal Information</h3>
                          <p class="text-sm text-neutral-400">Let's start with your basic details</p>
                        </div>
                        
                        <!-- Name Fields Row -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                          <!-- First Name Field -->
                          <div>
                            <label for="firstName" class="block text-sm font-medium text-neutral-200 mb-1.5">First Name *</label>
                            <input 
                              type="text" 
                              id="firstName" 
                              name="firstName" 
                              required
                              placeholder="e.g. John"
                              class="w-full px-3 py-2.5 bg-neutral-800/60 border border-white/10 rounded-lg text-white placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all text-sm"
                            >
                          </div>

                          <!-- Last Name Field -->
                          <div>
                            <label for="lastName" class="block text-sm font-medium text-neutral-200 mb-1.5">Last Name *</label>
                            <input 
                              type="text" 
                              id="lastName" 
                              name="lastName" 
                              required
                              placeholder="e.g. Smith"
                              class="w-full px-3 py-2.5 bg-neutral-800/60 border border-white/10 rounded-lg text-white placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all text-sm"
                            >
                          </div>
                        </div>

                        <!-- Email Field -->
                        <div>
                          <label for="email" class="block text-sm font-medium text-neutral-200 mb-1.5">Email Address *</label>
                          <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            required
                            placeholder="e.g. john@example.com"
                            class="w-full px-3 py-2.5 bg-neutral-800/60 border border-white/10 rounded-lg text-white placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all text-sm"
                          >
                        </div>
                      </div>

                      <!-- Step 2: Contact Details -->
                      <div id="step2" class="form-step hidden flex-1">
                        <div class="mb-4">
                          <h3 class="text-lg font-semibold text-white mb-2">Contact Details</h3>
                          <p class="text-sm text-neutral-400">How can we reach you?</p>
                        </div>
                        
                        <!-- Phone Field -->
                        <div class="mb-4">
                          <label for="phone" class="block text-sm font-medium text-neutral-200 mb-1.5">Phone Number *</label>
                          <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            required
                            placeholder="629446620"
                            class="w-full px-3 py-2.5 bg-neutral-800/60 border border-white/10 rounded-lg text-white placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all text-sm"
                          >
                        </div>

                        <!-- Practice Name Field -->
                        <div>
                          <label for="practiceName" class="block text-sm font-medium text-neutral-200 mb-1.5">Practice/Company Name</label>
                          <input 
                            type="text" 
                            id="practiceName" 
                            name="practiceName" 
                            placeholder="e.g. ABC Dental Practice"
                            class="w-full px-3 py-2.5 bg-neutral-800/60 border border-white/10 rounded-lg text-white placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all text-sm"
                          >
                        </div>
                      </div>

                      <!-- Step 3: Practice Information -->
                      <div id="step3" class="form-step hidden flex-1">
                        <div class="mb-4">
                          <h3 class="text-lg font-semibold text-white mb-2">Practice Information</h3>
                          <p class="text-sm text-neutral-400">Tell us about your practice setup</p>
                        </div>
                        
                        <!-- PMS Selection Field -->
                        <div class="mb-4">
                          <label for="pmsSystem" class="block text-sm font-medium text-neutral-200 mb-1.5">What's the Patient Management System you use? *</label>
                          <div class="relative">
                            <select 
                              id="pmsSystem" 
                              name="pmsSystem" 
                              required
                              class="w-full px-3 py-2.5 bg-neutral-800/60 border border-white/10 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all text-sm appearance-none cursor-pointer pr-10"
                              style="-webkit-appearance: none; -moz-appearance: none; appearance: none;"
                            >
                              <option value="" disabled selected class="text-neutral-400">Select your PMS system</option>
                              <option value="Praktika">Praktika</option>
                              <option value="Dental4windows / Dental4web">Dental4windows / Dental4web</option>
                              <option value="Core Practice">Core Practice</option>
                              <option value="Principle">Principle</option>
                              <option value="Dentally">Dentally</option>
                              <option value="Exact">Exact</option>
                              <option value="OrthoTrac">OrthoTrac</option>
                              <option value="Other">Other</option>
                            </select>
                            <!-- Custom dropdown arrow -->
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                              <svg class="h-4 w-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                              </svg>
                            </div>
                          </div>
                        </div>

                        <!-- Additional Information Field -->
                        <div class="mb-4">
                          <label for="additionalInfo" class="block text-sm font-medium text-neutral-200 mb-1.5">Additional Information</label>
                          <textarea 
                            id="additionalInfo" 
                            name="additionalInfo" 
                            rows="2"
                            placeholder="Tell us about your practice and what you'd like to achieve"
                            class="w-full px-3 py-2.5 bg-neutral-800/60 border border-white/10 rounded-lg text-white placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all resize-none text-sm"
                          ></textarea>
                        </div>

                        <!-- Consent Checkbox -->
                        <div class="flex items-start gap-3">
                          <input 
                            type="checkbox" 
                            id="consent" 
                            name="consent" 
                            required
                            class="mt-1 w-4 h-4 bg-neutral-800/60 border border-white/10 rounded text-indigo-500 focus:ring-2 focus:ring-indigo-500/50 focus:ring-offset-0"
                          >
                          <label for="consent" class="text-xs text-neutral-300 leading-relaxed">
                            I agree to receive communications about Voice AI services and understand that I can unsubscribe at any time. By submitting this form, I consent to the processing of my personal data in accordance with the 
                            <a href="/privacy-policy" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">Privacy Policy</a>.
                          </label>
                        </div>
                      </div>
                      
                    </div>

                    <!-- Success Message (Hidden by default) -->
                    <div id="bookingSuccessMessage" class="hidden bg-green-500/20 border border-green-500/30 rounded-lg p-3">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-400">
                          <path d="M20 6 9 17l-5-5"></path>
                        </svg>
                        <div>
                          <p class="text-green-300 font-medium text-sm">Contact created successfully!</p>
                          <p class="text-green-400/80 text-xs">Redirecting to calendar...</p>
                        </div>
                      </div>
                    </div>

                    <!-- Error Message (Hidden by default) -->
                    <div id="bookingErrorMessage" class="hidden bg-red-500/20 border border-red-500/30 rounded-lg p-3">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-400">
                          <circle cx="12" cy="12" r="10"></circle>
                          <line x1="15" x2="9" y1="9" y2="15"></line>
                          <line x1="9" x2="15" y1="9" y2="15"></line>
                        </svg>
                        <div>
                          <p class="text-red-300 font-medium text-sm">Failed to create contact</p>
                          <p class="text-red-400/80 text-xs">Proceeding to calendar anyway...</p>
                        </div>
                      </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex gap-3 mt-6">
                      <!-- Back Button -->
                      <button 
                        type="button"
                        id="backBtn"
                        class="hidden flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-neutral-700/50 hover:bg-neutral-600/50 text-white text-sm font-medium rounded-full transition-all duration-200 border border-white/10"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="m12 19-7-7 7-7"></path>
                          <path d="M19 12H5"></path>
                        </svg>
                        <span>Back</span>
                      </button>

                      <!-- Next Button -->
                      <button 
                        type="button"
                        id="nextBtn"
                        class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-white hover:bg-gray-100 text-slate-900 text-sm font-medium rounded-full transition-all duration-200 hover:scale-[1.02] shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
                      >
                        <span id="nextBtnText">Next Step</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M5 12h14"></path>
                          <path d="m12 5 7 7-7 7"></path>
                        </svg>
                      </button>

                      <!-- Submit Button (Hidden initially, shown on last step) -->
                      <button 
                        type="submit"
                        id="bookingSubmitBtn"
                        class="hidden flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-white hover:bg-gray-100 text-slate-900 text-sm font-medium rounded-full transition-all duration-200 hover:scale-[1.02] shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
                      >
                        <span id="bookingSubmitText">ðŸš€ Book My Demo Call</span>
                        <svg id="bookingSubmitIcon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M5 12h14"></path>
                          <path d="m12 5 7 7-7 7"></path>
                        </svg>
                        <!-- Loading Spinner (Hidden by default) -->
                        <svg id="bookingLoadingSpinner" class="hidden animate-spin" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M21 12a9 9 0 11-6.219-8.56"/>
                        </svg>
                      </button>
                    </div>

                  </form>
                </div>
      </div>
    
              <!-- International Phone Input CSS -->
              <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">
              
              <!-- Custom styles for intl-tel-input dark theme -->
              <style>
                .iti {
                  width: 100% !important;
                }
                
                .iti__flag-container {
                  background-color: transparent !important;
                  border: none !important;
                  border-radius: 0 !important;
                  overflow: visible !important;
                }
                
                .iti__flag-container .iti__selected-flag {
                  background-color: transparent !important;
                  border: none !important;
                  border-radius: 0 !important;
                }
                
                .iti__selected-flag {
                  background-color: transparent !important;
                  padding: 0 8px 0 12px !important;
                }
                
                .iti__arrow {
                  border-top-color: rgba(255, 255, 255, 0.7) !important;
                }
                
                .iti__country-list {
                  background-color: rgba(64, 64, 64, 0.95) !important;
                  border: 1px solid rgba(255, 255, 255, 0.1) !important;
                  border-radius: 0.5rem !important;
                  backdrop-filter: blur(10px) !important;
                  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5) !important;
                }
                
                .iti__country {
                  color: white !important;
                  padding: 8px 12px !important;
                }
                
                .iti__country:hover {
                  background-color: rgba(99, 102, 241, 0.2) !important;
                }
                
                .iti__country.iti__highlight {
                  background-color: rgba(99, 102, 241, 0.3) !important;
                }
                
                .iti__search-input {
                  background-color: rgba(64, 64, 64, 0.8) !important;
                  border: 1px solid rgba(255, 255, 255, 0.1) !important;
                  color: white !important;
                  border-radius: 0.375rem !important;
                  margin: 8px !important;
                  width: calc(100% - 16px) !important;
                }
                
                .iti__search-input::placeholder {
                  color: rgba(255, 255, 255, 0.5) !important;
                }
                
                .iti input[type="tel"] {
                  padding-left: 52px !important;
                  border-radius: 0.5rem !important;
                }
                
                /* Safari-specific select styling fixes */
                select {
                  -webkit-appearance: none !important;
                  -moz-appearance: none !important;
                  appearance: none !important;
                  background-image: none !important;
                }
                
                /* Ensure consistent option styling across browsers */
                select option {
                  background-color: rgba(64, 64, 64, 0.95) !important;
                  color: white !important;
                  padding: 8px 12px !important;
                }
                
                select option:checked {
                  background-color: rgba(99, 102, 241, 0.3) !important;
                }
                
                /* Safari focus state fix */
                select:focus {
                  outline: none !important;
                  box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5) !important;
                }
              </style>
              
              <!-- International Phone Input JS -->
              <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>
              
              <!-- Custom Form Handler -->
              <script>
                document.addEventListener('DOMContentLoaded', function() {
                  const form = document.getElementById('customBookingForm');
                  const submitBtn = document.getElementById('bookingSubmitBtn');
                  const submitText = document.getElementById('bookingSubmitText');
                  const submitIcon = document.getElementById('bookingSubmitIcon');
                  const loadingSpinner = document.getElementById('bookingLoadingSpinner');
                  const successMessage = document.getElementById('bookingSuccessMessage');
                  const errorMessage = document.getElementById('bookingErrorMessage');
                  
                  // Step navigation elements
                  const nextBtn = document.getElementById('nextBtn');
                  const backBtn = document.getElementById('backBtn');
                  const nextBtnText = document.getElementById('nextBtnText');
                  const currentStepNumber = document.getElementById('currentStepNumber');
                  const progressPercentage = document.getElementById('progressPercentage');
                  const progressBar = document.getElementById('progressBar');
                  const step1Label = document.getElementById('step1Label');
                  const step2Label = document.getElementById('step2Label');
                  const step3Label = document.getElementById('step3Label');
                  
                  // Step management
                  let currentStep = 1;
                  const totalSteps = 3;
                  const steps = ['step1', 'step2', 'step3'];
                  let stepStartTime = Date.now();
                  let lastTrackedStep = 0; // Prevent duplicate tracking
                  
                  // Step navigation functions
                  function updateProgress() {
                    const percentage = Math.round((currentStep / totalSteps) * 100);
                    currentStepNumber.textContent = currentStep;
                    progressPercentage.textContent = percentage;
                    progressBar.style.width = percentage + '%';
                    
                    // Update step labels
                    [step1Label, step2Label, step3Label].forEach((label, index) => {
                      if (index + 1 === currentStep) {
                        label.classList.add('text-indigo-400', 'font-medium');
                        label.classList.remove('text-neutral-400');
                      } else if (index + 1 < currentStep) {
                        label.classList.add('text-green-400', 'font-medium');
                        label.classList.remove('text-neutral-400', 'text-indigo-400');
                      } else {
                        label.classList.add('text-neutral-400');
                        label.classList.remove('text-indigo-400', 'text-green-400', 'font-medium');
                      }
                    });
                  }
                  
                  function showStep(stepNumber) {
                    // Hide all steps
                    steps.forEach(stepId => {
                      document.getElementById(stepId).classList.add('hidden');
                    });
                    
                    // Show current step
                    document.getElementById(steps[stepNumber - 1]).classList.remove('hidden');
                    
                    // Update navigation buttons
                    if (stepNumber === 1) {
                      backBtn.classList.add('hidden');
                      nextBtn.classList.remove('hidden');
                      submitBtn.classList.add('hidden');
                      nextBtnText.textContent = 'Next Step';
                    } else if (stepNumber === totalSteps) {
                      backBtn.classList.remove('hidden');
                      nextBtn.classList.add('hidden');
                      submitBtn.classList.remove('hidden');
                    } else {
                      backBtn.classList.remove('hidden');
                      nextBtn.classList.remove('hidden');
                      submitBtn.classList.add('hidden');
                      nextBtnText.textContent = 'Next Step';
                    }
                    
                    updateProgress();
                  }
                  
                  function validateCurrentStep() {
                    const currentStepElement = document.getElementById(steps[currentStep - 1]);
                    const requiredFields = currentStepElement.querySelectorAll('input[required], select[required]');
                    
                    for (let field of requiredFields) {
                      if (!field.value.trim()) {
                        field.focus();
                        field.classList.add('border-red-500');
                        setTimeout(() => field.classList.remove('border-red-500'), 3000);
                        return false;
                      }
                    }
                    
                    // Special validation for phone number on step 2
                    if (currentStep === 2 && iti && !iti.isValidNumber()) {
                      const phoneField = document.getElementById('phone');
                      phoneField.focus();
                      phoneField.classList.add('border-red-500');
                      setTimeout(() => phoneField.classList.remove('border-red-500'), 3000);
                      return false;
                    }
                    
                    return true;
                  }
                  
                  // Navigation event listeners
                  nextBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    if (validateCurrentStep()) {
                      if (currentStep < totalSteps) {
                        // Track specific step completion based on current step
                        if (currentStep === 1) {
                          // Step 1: Name, Last Name, Email completed
                          const firstName = document.getElementById('firstName').value;
                          const lastName = document.getElementById('lastName').value;
                          const email = document.getElementById('email').value;
                          
                          trackPersonalInfoCompleted({ 
                            ip: 'auto-detected',
                            firstName: firstName,
                            lastName: lastName,
                            email: email
                          }, { 
                            timeSpent: Date.now() - stepStartTime,
                            stepName: 'personal_info'
                          });
                        } else if (currentStep === 2) {
                          // Step 2: Phone, Practice Name completed
                          const phone = iti ? iti.getNumber() : document.getElementById('phone').value;
                          const practiceName = document.getElementById('practiceName').value;
                          const firstName = document.getElementById('firstName').value;
                          const lastName = document.getElementById('lastName').value;
                          const email = document.getElementById('email').value;
                          
                          trackContactInfoCompleted({ 
                            ip: 'auto-detected',
                            firstName: firstName,
                            lastName: lastName,
                            email: email,
                            phone: phone,
                            practiceName: practiceName
                          }, { 
                            timeSpent: Date.now() - stepStartTime,
                            stepName: 'contact_info'
                          });
                        }
                        
                        currentStep++;
                        showStep(currentStep);
                        
                        // Update step start time for new step
                        stepStartTime = Date.now();
                      }
                    }
                  });
                  
                  backBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    if (currentStep > 1) {
                      currentStep--;
                      showStep(currentStep);
                      
                      // Update step start time for new step
                      stepStartTime = Date.now();
                    }
                  });
                  
                  // Initialize first step
                  showStep(1);
                  
                  // Track form initialization
                  trackFormInitialized({ ip: 'auto-detected' }, { form_entry_point: 'book_a_call_page' });

                  // Initialize International Phone Input
                  const phoneInput = document.querySelector("#phone");
                  let iti;
                  
                  // Function to detect country from timezone (expanded for global coverage)
                  function getCountryFromTimezone() {
                    try {
                      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                      const timezoneToCountry = {
                        // Australia & New Zealand
                        'Australia/Sydney': 'au', 'Australia/Melbourne': 'au', 'Australia/Brisbane': 'au',
                        'Australia/Perth': 'au', 'Australia/Adelaide': 'au', 'Australia/Darwin': 'au',
                        'Pacific/Auckland': 'nz', 'Pacific/Chatham': 'nz',
                        
                        // Europe
                        'Europe/London': 'gb', 'Europe/Dublin': 'ie', 'Europe/Amsterdam': 'nl',
                        'Europe/Berlin': 'de', 'Europe/Paris': 'fr', 'Europe/Madrid': 'es',
                        'Europe/Rome': 'it', 'Europe/Vienna': 'at', 'Europe/Brussels': 'be',
                        'Europe/Zurich': 'ch', 'Europe/Stockholm': 'se', 'Europe/Oslo': 'no',
                        'Europe/Copenhagen': 'dk', 'Europe/Helsinki': 'fi', 'Europe/Warsaw': 'pl',
                        'Europe/Prague': 'cz', 'Europe/Budapest': 'hu', 'Europe/Bucharest': 'ro',
                        'Europe/Sofia': 'bg', 'Europe/Athens': 'gr', 'Europe/Lisbon': 'pt',
                        
                        // North America
                        'America/New_York': 'us', 'America/Los_Angeles': 'us', 'America/Chicago': 'us',
                        'America/Denver': 'us', 'America/Phoenix': 'us', 'America/Anchorage': 'us',
                        'America/Toronto': 'ca', 'America/Vancouver': 'ca', 'America/Montreal': 'ca',
                        'America/Mexico_City': 'mx', 'America/Tijuana': 'mx',
                        
                        // Middle East & Asia
                        'Asia/Dubai': 'ae', 'Asia/Riyadh': 'sa', 'Asia/Kuwait': 'kw',
                        'Asia/Qatar': 'qa', 'Asia/Bahrain': 'bh', 'Asia/Muscat': 'om',
                        'Asia/Tokyo': 'jp', 'Asia/Seoul': 'kr', 'Asia/Shanghai': 'cn',
                        'Asia/Hong_Kong': 'hk', 'Asia/Singapore': 'sg', 'Asia/Bangkok': 'th',
                        'Asia/Manila': 'ph', 'Asia/Jakarta': 'id', 'Asia/Kuala_Lumpur': 'my',
                        'Asia/Kolkata': 'in', 'Asia/Karachi': 'pk', 'Asia/Dhaka': 'bd',
                        
                        // South America
                        'America/Sao_Paulo': 'br', 'America/Argentina/Buenos_Aires': 'ar',
                        'America/Santiago': 'cl', 'America/Lima': 'pe', 'America/Bogota': 'co',
                        
                        // Africa
                        'Africa/Cairo': 'eg', 'Africa/Lagos': 'ng', 'Africa/Johannesburg': 'za',
                        'Africa/Nairobi': 'ke', 'Africa/Casablanca': 'ma'
                      };
                      return timezoneToCountry[timezone] || null;
                    } catch (e) {
                      return null;
                    }
                  }
                  
                  // Determine initial country based on multiple sources
                  let initialCountry = 'us'; // default
                  
                  // Try user region first
                  const userRegion = window.userRegion;
                  if (userRegion) {
                    const regionToCountry = {
                      'AU': 'au',
                      'NZ': 'nz', 
                      'UK': 'gb',
                      'IE': 'ie',
                      'US': 'us',
                      'CA': 'ca',
                      'NL': 'nl',
                      'AE': 'ae'
                    };
                    if (regionToCountry[userRegion]) {
                      initialCountry = regionToCountry[userRegion];
                    }
                  } else {
                    // Fallback to timezone detection
                    const timezoneCountry = getCountryFromTimezone();
                    if (timezoneCountry) {
                      initialCountry = timezoneCountry;
                    }
                  }

                  console.log('Phone input initializing with country:', initialCountry, 'from userRegion:', userRegion);
                  console.log('Browser timezone:', Intl.DateTimeFormat().resolvedOptions().timeZone);
                  console.log('Timezone detected country:', getCountryFromTimezone());

                  // Initialize intl-tel-input with universal auto country detection
                  iti = window.intlTelInput(phoneInput, {
                    initialCountry: "auto",
                    geoIpLookup: function(success, failure) {
                      console.log('geoIpLookup called - userRegion:', userRegion, 'initialCountry:', initialCountry);
                      
                      // Try multiple geolocation services for better accuracy
                      const geoServices = [
                        // Service 1: ipapi.co (most reliable)
                        () => fetch('https://ipapi.co/json/').then(r => r.json()),
                        // Service 2: ip-api.com (backup)
                        () => fetch('http://ip-api.com/json/').then(r => r.json()),
                        // Service 3: ipinfo.io (backup)
                        () => fetch('https://ipinfo.io/json').then(r => r.json())
                      ];
                      
                      async function tryGeoServices() {
                        for (let i = 0; i < geoServices.length; i++) {
                          try {
                            console.log(`Trying geo service ${i + 1}...`);
                            const data = await geoServices[i]();
                            console.log(`Geo service ${i + 1} response:`, data);
                            
                            // Extract country code from different service formats
                            let countryCode = null;
                            if (data.country_code) countryCode = data.country_code; // ipapi.co
                            else if (data.countryCode) countryCode = data.countryCode; // ip-api.com  
                            else if (data.country) countryCode = data.country; // ipinfo.io
                            
                            if (countryCode) {
                              const finalCountry = countryCode.toLowerCase();
                              console.log(`Successfully detected country: ${finalCountry}`);
                              success(finalCountry);
                              return;
                            }
                          } catch (error) {
                            console.log(`Geo service ${i + 1} failed:`, error);
                            continue;
                          }
                        }
                        
                        // If all services fail, use our detected country or timezone fallback
                        console.log('All geo services failed, using fallback');
                        const fallbackCountry = initialCountry || 'us';
                        console.log('Using fallback country:', fallbackCountry);
                        success(fallbackCountry);
                      }
                      
                      tryGeoServices();
                    },
                    preferredCountries: ['au', 'nz', 'gb', 'ie', 'us', 'ca', 'nl', 'ae', 'de', 'fr', 'es', 'it'],
                    utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/utils.js",
                    autoPlaceholder: "aggressive",
                    separateDialCode: false,
                    nationalMode: true,
                    formatOnDisplay: true,
                    customPlaceholder: function(selectedCountryPlaceholder, selectedCountryData) {
                      return selectedCountryPlaceholder;
                    }
                  });

                  // Style the intl-tel-input to match our dark theme
                  function applyPhoneInputStyling() {
                    const itiContainer = phoneInput.parentNode.querySelector('.iti');
                    if (itiContainer) {
                      itiContainer.style.width = '100%';
                      
                      // Style the flag dropdown to be transparent and seamless
                      const flagContainer = itiContainer.querySelector('.iti__flag-container');
                      if (flagContainer) {
                        flagContainer.style.backgroundColor = 'transparent';
                        flagContainer.style.border = 'none';
                        flagContainer.style.borderRadius = '0';
                        flagContainer.style.overflow = 'visible';
                        
                        // Also style the selected flag element inside
                        const selectedFlag = flagContainer.querySelector('.iti__selected-flag');
                        if (selectedFlag) {
                          selectedFlag.style.backgroundColor = 'transparent';
                          selectedFlag.style.border = 'none';
                          selectedFlag.style.borderRadius = '0';
                        }
                      }
                      
                      // Update phone input styles - now with full rounded corners
                      phoneInput.style.paddingLeft = '52px';
                      phoneInput.style.borderRadius = '0.5rem';
                    }
                  }
                  
                  // Apply styling immediately and after a short delay to ensure it sticks
                  applyPhoneInputStyling();
                  setTimeout(applyPhoneInputStyling, 100);
                  setTimeout(applyPhoneInputStyling, 500);

                  // GHL Webhook URL
                  const webhookUrl = 'https://services.leadconnectorhq.com/hooks/gY3OLBcxMMuSg4TsW3bO/webhook-trigger/79248a88-1836-4270-a798-bda450d6d255';

                  // Function to format phone number based on user's location
                  function formatPhoneNumber() {
                    if (!iti) return '';
                    
                    // Get the national number (without country code)
                    const nationalNumber = iti.getNumber(window.intlTelInputUtils.numberFormat.NATIONAL);
                    const selectedCountryData = iti.getSelectedCountryData();
                    
                    // Clean the national number
                    let formattedPhone = nationalNumber.replace(/[\s\-\(\)]/g, '').replace(/^\+\d+/, '');
                    
                    // Handle specific country formatting
                    if (selectedCountryData.iso2 === 'nl' && !formattedPhone.startsWith('0')) {
                      formattedPhone = '0' + formattedPhone;
                    }
                    
                    return formattedPhone;
                  }

                  // Function to build calendar URL with parameters
                  function buildCalendarUrl(formData) {
                    const baseUrl = 'https://api.leadconnectorhq.com/widget/booking/PcUyCv42lP91GzQuqkgU';
                    const params = new URLSearchParams();
                    
                    // Format phone number appropriately
                    const formattedPhone = formatPhoneNumber();
                    
                    // Add contact data with multiple parameter variations for maximum compatibility
                    if (formData.firstName && formData.lastName) {
                      const fullName = `${formData.firstName} ${formData.lastName}`;
                      params.set('full_name', fullName);
                      params.set('name', fullName);
                      params.set('contact_name', fullName);
                    }
                    if (formData.firstName) {
                      params.set('first_name', formData.firstName);
                      params.set('firstName', formData.firstName);
                      params.set('fname', formData.firstName);
                    }
                    if (formData.lastName) {
                      params.set('last_name', formData.lastName);
                      params.set('lastName', formData.lastName);
                      params.set('lname', formData.lastName);
                    }
                    if (formData.email) {
                      params.set('email', formData.email);
                      params.set('email_address', formData.email);
                      params.set('emailAddress', formData.email);
                    }
                    if (formattedPhone) {
                      params.set('phone', formattedPhone);
                      params.set('phone_number', formattedPhone);
                      params.set('phoneNumber', formattedPhone);
                      params.set('mobile', formattedPhone);
                    }
                    
                    return `${baseUrl}?${params.toString()}`;
                  }

                  // Function to store sticky contact data
                  function storeStickyContact(formData) {
                    const contactData = {
                      full_name: `${formData.firstName} ${formData.lastName}`,
                      first_name: formData.firstName,
                      last_name: formData.lastName,
                      email: formData.email,
                      phone: formData.phone,
                      practice_name: formData.practiceName,
                      pms_system: formData.pmsSystem,
                      additional_info: formData.additionalInfo,
                      timestamp: new Date().toISOString(),
                      source: 'custom_booking_form'
                    };
                    
                    localStorage.setItem('stickyContactData', JSON.stringify(contactData));
                    console.log('Sticky contact data stored:', contactData);
                    return contactData;
                  }

                  form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(form);
                    
                    // Validate phone number
                    if (iti && !iti.isValidNumber()) {
                      alert('Please enter a valid phone number');
                      return;
                    }
                    
                    const contactData = {
                      firstName: formData.get('firstName'),
                      lastName: formData.get('lastName'),
                      email: formData.get('email'),
                      phone: iti ? iti.getNumber() : formData.get('phone'), // Get full international number
                      practiceName: formData.get('practiceName') || '',
                      pmsSystem: formData.get('pmsSystem'),
                      additionalInfo: formData.get('additionalInfo') || ''
                    };

                    // Show loading state
                    submitBtn.disabled = true;
                    submitText.textContent = 'Creating Contact...';
                    submitIcon.classList.add('hidden');
                    loadingSpinner.classList.remove('hidden');
                    successMessage.classList.add('hidden');
                    errorMessage.classList.add('hidden');

                    // Store sticky contact data
                    const stickyData = storeStickyContact(contactData);

                    // Get location information
                    const selectedCountryData = iti ? iti.getSelectedCountryData() : null;
                    const userRegion = window.userRegion || 'GLOBAL';
                    const currentGeoContent = window.currentGeoContent || window.geoContent['GLOBAL'];
                    const browserTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    
                    // Prepare payload for GHL webhook
                    const payload = {
                      firstName: contactData.firstName,
                      lastName: contactData.lastName,
                      name: `${contactData.firstName} ${contactData.lastName}`,
                      email: contactData.email,
                      phone: contactData.phone,
                      company: contactData.practiceName,
                      message: contactData.additionalInfo,
                      source: 'Website Booking Form',
                      tags: ['Website Lead', 'Booking Form', 'Demo Request'],
                      "what's_the_patient_management_system_you_use?": contactData.pmsSystem,
                      // Location data
                      country: selectedCountryData ? selectedCountryData.name : 'Unknown',
                      countryCode: selectedCountryData ? selectedCountryData.iso2.toUpperCase() : 'US',
                      region: userRegion,
                      timezone: browserTimezone,
                      currency: currentGeoContent.currency,
                      serviceArea: currentGeoContent.serviceArea,
                      customFields: {
                        lead_source: 'Website Booking Form',
                        practice_name: contactData.practiceName,
                        pms_system: contactData.pmsSystem,
                        inquiry_type: 'Demo Booking',
                        additional_info: contactData.additionalInfo,
                        // Location custom fields
                        detected_country: selectedCountryData ? selectedCountryData.name : 'Unknown',
                        country_code: selectedCountryData ? selectedCountryData.iso2.toUpperCase() : 'US',
                        user_region: userRegion,
                        browser_timezone: browserTimezone,
                        detected_currency: currentGeoContent.currency,
                        service_area: currentGeoContent.serviceArea,
                        phone_country: selectedCountryData ? selectedCountryData.dialCode : '+1'
                      }
                    };

                    // Log the payload for debugging
                    console.log('Webhook payload with location data:', payload);

                    try {
                      // Send to GHL webhook
                      const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                          'Content-Type': 'application/json',
                          'Accept': 'application/json'
                        },
                        body: JSON.stringify(payload)
                      });

                      if (response.ok) {
                        // Show success message
                        successMessage.classList.remove('hidden');
                        console.log('Contact created successfully in GHL');
                        
                        // Track success event
                        if (window.clarity && typeof window.clarity === 'function') {
                          window.clarity("event", "BookingFormSubmitted");
                        }
                        
                        // Track final step completion (PMS selection and additional notes)
                        const firstName = contactData.firstName;
                        const lastName = contactData.lastName;
                        const email = contactData.email;
                        const phone = contactData.phone;
                        const practiceName = contactData.practiceName;
                        const pmsSystem = contactData.pmsSystem;
                        
                        trackPracticeInfoCompleted({ 
                          ip: 'auto-detected',
                          firstName: firstName,
                          lastName: lastName,
                          email: email,
                          phone: phone,
                          practiceName: practiceName,
                          pmsSystem: pmsSystem
                        }, { 
                          completionTime: Date.now() - stepStartTime,
                          form_success: true,
                          submission_id: Date.now().toString(),
                          stepName: 'practice_info'
                        });
                      } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                      }
                    } catch (error) {
                      console.error('GHL webhook error:', error);
                      errorMessage.classList.remove('hidden');
                      
                      // Track error event
                      if (window.clarity && typeof window.clarity === 'function') {
                        window.clarity("event", "BookingFormError");
                      }
                    }

                    // Build calendar URL with parameters
                    const calendarUrl = buildCalendarUrl(contactData);
                    console.log('Redirecting to calendar:', calendarUrl);

                    // Redirect to calendar after short delay (whether webhook succeeded or failed)
                    setTimeout(() => {
                      window.location.href = calendarUrl;
                    }, 2000);
                  });
                });
              </script>
              
              </div>
    
    
                </div>
        </section>

        <script>
          // Initialize countdown timer for book-a-call page
          document.addEventListener('DOMContentLoaded', function() {
            // Set countdown to October 9th, 2025 at 11:59 PM
            const targetDate = new Date('2025-10-09T23:59:59').getTime();

            function updateBookACallCountdown() {
              const now = new Date().getTime();
              const timeLeft = targetDate - now;

              if (timeLeft > 0) {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                let formattedTime;
                if (days > 0) {
                  formattedTime = `${days}d ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                } else {
                  formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }

                // Update book-a-call countdown timer
                const timerElement = document.getElementById('book-a-call-countdown-timer');
                if (timerElement) {
                  timerElement.textContent = formattedTime;
                }
              } else {
                // Timer expired, show "EXPIRED"
                const timerElement = document.getElementById('book-a-call-countdown-timer');
                if (timerElement) {
                  timerElement.textContent = 'EXPIRED';
                }
              }
            }

            // Update immediately and then every second
            updateBookACallCountdown();
            setInterval(updateBookACallCountdown, 1000);
          });
        </script>

        <!-- CAPI Functions -->
        <script>
          // Meta Conversions API Utility Functions
          async function sendCAPIEvents(events, pixelId = '480750607959393') {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
              console.warn('CAPI events are skipped on localhost.');
              return { success: true, message: 'CAPI skipped on localhost' };
            }

            try {
              const response = await fetch('/api/capi', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({ events, pixelId })
              });

              const responseData = await response.json();

              if (!response.ok) {
                console.error('CAPI Serverless Request Error:', responseData);
                return { success: false, error: responseData };
              }

              console.log('CAPI Success:', responseData);
              return { success: true, data: responseData };

            } catch (error) {
              console.error('CAPI Request Error:', error);
              return { success: false, error: error.message };
            }
          }

          async function hashPII(data) {
            if (!data) return null;
            const textEncoder = new TextEncoder();
            const dataBuffer = textEncoder.encode(data.trim().toLowerCase());
            const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hexHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hexHash;
          }

          async function createFormEvent(eventName, formData = {}, stepData = {}) {
            // Hash PII data for better matching
            const hashedEmail = formData.email ? await hashPII(formData.email) : undefined;
            const hashedPhone = formData.phone ? await hashPII(formData.phone) : undefined;
            const hashedFirstName = formData.firstName ? await hashPII(formData.firstName) : undefined;
            const hashedLastName = formData.lastName ? await hashPII(formData.lastName) : undefined;
            
            const event = {
              event_name: eventName,
              event_time: Math.floor(Date.now() / 1000),
              action_source: 'website',
              event_source_url: window.location.href,
              user_data: {
                client_ip_address: formData.ip || undefined,
                client_user_agent: navigator.userAgent,
                fbc: getCookie('_fbc') || undefined,
                fbp: getCookie('_fbp') || undefined,
                // High-value matching parameters
                em: hashedEmail,
                ph: hashedPhone,
                fn: hashedFirstName,
                ln: hashedLastName,
                // Additional location data for better matching
                ct: formData.city || undefined,
                st: formData.state || undefined,
                zp: formData.postal || undefined,
                country: formData.country || undefined,
              },
              custom_data: {
                form_type: 'book_a_call',
                form_step: stepData.step || 1,
                step_name: stepData.stepName || 'step_1',
                time_spent: stepData.timeSpent || 0,
                form_progress: stepData.progress || 0,
                // Include unhashed data for custom analytics
                practice_name: formData.practiceName || undefined,
                pms_system: formData.pmsSystem || undefined,
                ...stepData.customData
              }
            };
            return event;
          }

          async function trackFormInitialized(formData = {}, stepData = {}) {
            const event = await createFormEvent('FormInitialized', formData, {
              step: 1,
              stepName: 'form_initialized',
              progress: 0,
              form_entry_point: 'book_a_call_page',
              ...stepData
            });
            
            console.log('ðŸš€ Form Initialized:', event);
            
            const result = await sendCAPIEvents([event]);
            
            if (result.success) {
              console.log('âœ… Form Initialized event sent successfully!');
            } else {
              console.error('âŒ Form Initialized event failed:', result.error);
            }
            
            return result;
          }

          async function trackPersonalInfoCompleted(formData = {}, stepData = {}) {
            const event = await createFormEvent('PersonalInfoCompleted', formData, {
              step: 1,
              stepName: 'personal_info',
              progress: 33,
              step_description: 'Name, Last Name, Email completed',
              ...stepData
            });
            
            console.log('ðŸ‘¤ Personal Info Completed:', event);
            
            const result = await sendCAPIEvents([event]);
            
            if (result.success) {
              console.log('âœ… Personal Info Completed event sent successfully!');
            } else {
              console.error('âŒ Personal Info Completed event failed:', result.error);
            }
            
            return result;
          }

          async function trackContactInfoCompleted(formData = {}, stepData = {}) {
            const event = await createFormEvent('ContactInfoCompleted', formData, {
              step: 2,
              stepName: 'contact_info',
              progress: 66,
              step_description: 'Phone, Practice Name completed',
              ...stepData
            });
            
            console.log('ðŸ“ž Contact Info Completed:', event);
            
            const result = await sendCAPIEvents([event]);
            
            if (result.success) {
              console.log('âœ… Contact Info Completed event sent successfully!');
            } else {
              console.error('âŒ Contact Info Completed event failed:', result.error);
            }
            
            return result;
          }

          async function trackPracticeInfoCompleted(formData = {}, stepData = {}) {
            const event = await createFormEvent('PracticeInfoCompleted', formData, {
              step: 3,
              stepName: 'practice_info',
              progress: 100,
              step_description: 'PMS selection and additional notes completed',
              form_success: true,
              ...stepData
            });
            
            console.log('ðŸ¥ Practice Info Completed:', event);
            
            const result = await sendCAPIEvents([event]);
            
            if (result.success) {
              console.log('âœ… Practice Info Completed event sent successfully!');
            } else {
              console.error('âŒ Practice Info Completed event failed:', result.error);
            }
            
            return result;
          }

          function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
          }
        </script>
        
        <!-- Spacing between blue background and next section -->
        <div class="h-16 sm:h-20 lg:h-24"></div>
